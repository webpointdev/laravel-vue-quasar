(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{1867:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",[[a("div",[a("q-table",{class:"ios"===t.is_mobile?"my-sticky-dynamic table-top-ios":"android"===t.is_mobile?"my-sticky-dynamic table-top-android":"my-sticky-dynamic",attrs:{data:t.dpdDataList,columns:t.columns,"row-key":"dpdDate",filter:t.filter,"binary-state-sort":"",pagination:t.pagination,"virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,"rows-per-page-options":[0]},on:{request:t.getDpdDataList,"update:pagination":function(e){t.pagination=e},"virtual-scroll":t.onScroll},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticClass:"col-6 row justify-start q-pr-sm"},[a("q-btn",{staticStyle:{width:"130px",height:"40px"},attrs:{color:"blue-7",label:t.dpdSid?"UPDATE":"LOGIN","no-caps":"",dense:"",rounded:""},on:{click:t.showDpdLoginDlg}})],1),a("div",{staticClass:"col-6 row justify-end q-pl-sm"},[a("q-select",{staticClass:"q-select-list",attrs:{dense:"",options:t.periods,"option-value":function(t){return null==t?null:t},"option-label":function(t){return null==t?"- Null -":t.duration},"bg-color":"transparent",color:"blue-7","label-color":"whtie",behavior:"menu"},on:{input:t.onChangePeriod},model:{value:t.selectedPeriod,callback:function(e){t.selectedPeriod=e},expression:"selectedPeriod"}})],1)]},proxy:!0},{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e},nativeOn:{click:function(a){return t.goToDetail(e.row.dpdDate)}}},[a("q-td",{key:"no",attrs:{props:e}},[t._v(t._s(e.row.index))]),a("q-td",{key:"dpdData",staticClass:"text-uppercase",attrs:{props:e}},[t._v(t._s(t.changeDateFormat(e.row.dpdDate)))]),a("q-td",{key:"route_count",attrs:{props:e}},[t._v(t._s(e.row.route_count))]),a("q-td",{key:"buttons",attrs:{props:e}},[a("q-btn",{attrs:{rounded:"",flat:"",icon:"fas fa-pen-alt"},on:{click:function(a){return t.goToDetail(e.row.dpdDate)}},nativeOn:{click:function(t){t.stopPropagation()}}})],1)],1)]}},{key:"bottom",fn:function(){return[a("div",{staticClass:"col-12 row justify-between"},[a("div",{staticClass:"q-my-auto"}),a("div",{staticClass:"row justify-end items-center"},[t._v("\n              Total Records: "+t._s(t.pagination.rowsNumber)+"\n            ")])])]},proxy:!0}])})],1),a("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.showLoginDlg,callback:function(e){t.showLoginDlg=e},expression:"showLoginDlg"}},[a("q-card",{staticStyle:{"background-color":"#3e444e","max-width":"500px","min-width":"352px","min-height":"300px"}},[a("q-bar",{staticStyle:{"background-color":"#272b33"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close",color:"white"}},[a("q-tooltip",{attrs:{"content-class":"bg-white text-black"}},[t._v("Close")])],1)],1),a("q-separator"),a("div",[a("q-card-section",[a("q-form",{ref:"dpdUserForm",attrs:{model:t.dpdUser},on:{submit:t.dpdLogin}},[a("div",{staticClass:"text-h6 text-white text-center"},[t._v("ODF LOGIN")]),a("span",{staticClass:"text-white"},[t._v("Username")]),a("q-input",{staticClass:"q-pb-md",attrs:{required:"",dense:"",outlined:"","bg-color":"blue-grey-4","input-class":"text-white q-pr-xl","label-color":"grey-3",color:"blue-7"},model:{value:t.dpdUser.email,callback:function(e){t.$set(t.dpdUser,"email",e)},expression:"dpdUser.email"}}),a("span",{staticClass:"text-white"},[t._v("Password")]),a("base-text-field",{staticClass:"q-pb-md",attrs:{required:"",dense:"",outlined:"","bg-color":"blue-grey-4","input-class":"text-white q-pr-xl","label-color":"grey-3",color:"blue-7",type:"password","hide-show-password":""},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"mdi-account-key"}})]},proxy:!0}]),model:{value:t.dpdUser.password,callback:function(e){t.$set(t.dpdUser,"password",e)},expression:"dpdUser.password"}}),a("q-card-actions",{attrs:{align:"center"}},[a("q-btn",{staticClass:"q-mt-xs",staticStyle:{width:"100px",height:"40px"},attrs:{label:"DPD Login",color:"blue-7","no-caps":"",dense:"",rounded:"",type:"submit"}})],1)],1)],1)],1)],1)],1)]],2)},n=[],i=a("a34a"),o=a.n(i),s=(a("96cf"),a("c973")),d=a.n(s),c=(a("28a5"),a("1e53")),l=a("f508"),p=a("bd4c"),u=a("a357");function f(t,e){console.log("csv",t);var a=void 0!==e?e(t):t;return a=void 0===a||null===a?"":String(a),a=a.split('"').join('""'),'"'.concat(a,'"')}var g={name:"DPD",data:function(){return{filter:"",showLoginDlg:!1,dpdUser:{email:"",password:""},selectedPeriod:{},periods:[],pagination:{sortBy:"dpdDate",descending:!0,page:1,rowsPerPage:100,rowsNumber:20},columns:[{name:"no",required:!0,label:"NO",align:"left",field:"no"},{name:"dpdData",required:!0,label:"DATE",align:"left",field:"dpdData"},{name:"route_count",required:!0,label:"COUNT",align:"left",field:"route_count"},{name:"buttons",label:"",field:"buttons"}],dpdDataList:[],is_mobile:"web"}},computed:{dpdSid:{get:function(){return this.$store.state.auth.dpdSid}}},mounted:function(){var t=this;return d()(o.a.mark((function e(){return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.checkPlatform(),t.$store.commit("auth/pageTitle",t.$router.currentRoute.meta.title),e.next=4,t.getPeriods();case 4:case"end":return e.stop()}}),e)})))()},methods:{goToDetail:function(t){this.$router.push({name:"Edit DPD Modules",params:{dpdDate:t}})},checkPlatform:function(){this.$q.platform.is.mobile?this.$q.platform.is.ios?this.is_mobile="ios":this.is_mobile="android":this.is_mobile="web"},changeDateFormat:function(t){var e=p["b"].formatDate(p["b"].addToDate(p["b"].extractDate(t,"YYYY-MM-DD"),{hours:5}),"DD-MM-YY ddd");return e},showDpdLoginDlg:function(){this.periods.length&&this.dpdSid?this.updateDpdData():this.showLoginDlg=!0},getPeriods:function(){var t=this;return d()(o.a.mark((function e(){var a,r;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return l["a"].show(),e.prev=1,(new Date).getFullYear(),a=p["b"].formatDate(new Date,"YYYY-MM-DD"),e.next=6,c["a"].getPeriods(a);case 6:if(r=e.sent,l["a"].hide(),t.periods=r.data.data,t.periods.length&&(t.selectedPeriod=t.periods.filter((function(t){if(t.firstTransactionDate<=a&&t.lastTransactionDate>=a)return t}))[0]),t.periods.length){e.next=14;break}t.showLoginDlg=!0,e.next=16;break;case 14:return e.next=16,t.getDpdDataList({pagination:t.pagination,filter:t.filter,isScroll:!1});case 16:e.next=22;break;case 18:e.prev=18,e.t0=e["catch"](1),console.log("get periods error",e.t0),l["a"].hide();case 22:case"end":return e.stop()}}),e,null,[[1,18]])})))()},exportTable:function(){var t=this.columns,e=[t.map((function(t){return f(t.label)}))].concat(this.dpdDataList.map((function(e){return t.map((function(t){return"is_group"===t.field?f(1===e.is_group?"DAILY":"EXTRA",t.format):"user_name"===t.field?f(e.user.full_name,t.format):"report_date"===t.field?f(e.report_date,t.format):f(e[t.field],t.format)})).join(",")}))).join("\r\n"),a=Object(u["a"])("table-export.csv",e,"text/csv");!0!==a&&this.$q.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},updateDpdData:function(){var t=this;return d()(o.a.mark((function e(){var a;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return l["a"].show(),e.prev=1,a={sid:t.dpdSid,period:{startDate:t.selectedPeriod.firstTransactionDate,endDate:t.selectedPeriod.lastTransactionDate,previousCutOffDate:t.selectedPeriod.previousCutOffDate,cutOffDate:t.selectedPeriod.cutOffDate}},e.next=5,c["a"].updateDpdData(a);case 5:return e.next=7,t.getDpdDataList({pagination:t.pagination,filter:t.filter,isScroll:!1});case 7:l["a"].hide(),e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](1),console.log("get periods error",e.t0),l["a"].hide();case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))()},dpdLogin:function(){var t=this;return d()(o.a.mark((function e(){var a,r,n,i;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(l["a"].show(),e.prev=1,a={},!t.periods.length){e.next=11;break}return r={email:t.dpdUser.email,password:t.dpdUser.password,period:{startDate:t.selectedPeriod.firstTransactionDate,endDate:t.selectedPeriod.lastTransactionDate,previousCutOffDate:t.selectedPeriod.previousCutOffDate,cutOffDate:t.selectedPeriod.cutOffDate}},e.next=7,c["a"].dpdLogin(r);case 7:a=e.sent,t.$store.commit("auth/setDpdSid",a.data.sid),e.next=19;break;case 11:return n=p["b"].formatDate(new Date,"YYYY-MM-DD"),i={email:t.dpdUser.email,password:t.dpdUser.password,currentDate:n},e.next=15,c["a"].getDpdPeriods(i);case 15:a=e.sent,t.$store.commit("auth/setDpdSid",a.data.sid),t.periods=a.data.data,t.periods.length&&(t.selectedPeriod=t.periods.filter((function(t){if(t.firstTransactionDate<=n&&t.lastTransactionDate>=n)return t}))[0]);case 19:t.showLoginDlg=!1,l["a"].hide(),e.next=28;break;case 23:e.prev=23,e.t0=e["catch"](1),console.log("dpd login error",e.t0),l["a"].hide(),t.showLoginDlg=!1;case 28:case"end":return e.stop()}}),e,null,[[1,23]])})))()},onScroll:function(t){var e=this;return d()(o.a.mark((function a(){var r,n,i,s,d,c,l;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=t.index,t.from,t.to,t.ref,n=e.pagination,i=n.page,s=n.rowsPerPage,d=n.rowsNumber,c=e.dpdDataList.length-1,l=Math.ceil(d/s),!(r>0&&i<l&&r===c)){a.next=8;break}return e.pagination.page++,a.next=8,e.getDpdDataList({pagination:e.pagination,filter:e.filter,isScroll:!0});case 8:case"end":return a.stop()}}),a)})))()},onChangePeriod:function(){var t=this;return d()(o.a.mark((function e(){return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getDpdDataList({pagination:t.pagination,filter:t.filter,isScroll:!1});case 2:case"end":return e.stop()}}),e)})))()},getDpdDataList:function(){var t=d()(o.a.mark((function t(e){var a,r,n,i,s,d,p,u,f,g,h,D;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.selectedPeriod.firstTransactionDate){t.next=28;break}return a=e.pagination,r=a.page,n=a.rowsPerPage,i=a.rowsNumber,s=a.sortBy,d=a.descending,p=e.filter,u=e.isScroll,f=0===n?i:n,g=(r-1)*n,h={start:g,numPerPage:f,sortBy:s,descending:d,fromDate:this.selectedPeriod.firstTransactionDate,endDate:this.selectedPeriod.lastTransactionDate},p&&(h.conditions.filter=p),l["a"].show(),t.prev=9,t.next=12,c["a"].getDpdDatas(h);case 12:D=t.sent,l["a"].hide(),D.data.data.forEach((function(t,e){t.index=100*(r-1)+e+1})),this.dpdDataList=u?this.dpdDataList.concat(D.data.data):D.data.data,this.pagination.rowsNumber=D.data.totalCount,this.pagination.page=r,this.pagination.rowsPerPage=n,this.pagination.sortBy=s,this.pagination.descending=d,t.next=26;break;case 23:t.prev=23,t.t0=t["catch"](9),l["a"].hide();case 26:t.next=30;break;case 28:return this.$q.notify({message:"Please choose the period first...",color:"negative",icon:"warning"}),t.abrupt("return");case 30:case"end":return t.stop()}}),t,this,[[9,23]])})));function e(e){return t.apply(this,arguments)}return e}()},created:function(){}},h=g,D=(a("702b"),a("2877")),m=a("9989"),b=a("eaac"),w=a("9c40"),v=a("ddd8"),x=a("bd08"),k=a("db86"),y=a("24e8"),P=a("f09f"),q=a("d847"),_=a("05c0"),L=a("eb85"),C=a("a370"),T=a("0378"),S=a("27f9"),O=a("0016"),Q=a("4b7e"),U=a("7f67"),Y=a("eebe"),$=a.n(Y),N=Object(D["a"])(h,r,n,!1,null,null,null);e["default"]=N.exports;$()(N,"components",{QPage:m["a"],QTable:b["a"],QBtn:w["a"],QSelect:v["a"],QTr:x["a"],QTd:k["a"],QDialog:y["a"],QCard:P["a"],QBar:q["a"],QTooltip:_["a"],QSeparator:L["a"],QCardSection:C["a"],QForm:T["a"],QInput:S["a"],QIcon:O["a"],QCardActions:Q["a"]}),$()(N,"directives",{ClosePopup:U["a"]})},"3f83":function(t,e,a){},"702b":function(t,e,a){"use strict";var r=a("3f83"),n=a.n(r);n.a}}]);