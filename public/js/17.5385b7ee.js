(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{"5b1f":function(t,e,a){"use strict";var r=a("a76a"),i=a.n(r);i.a},9952:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",[[a("div",[a("q-table",{class:"ios"===t.is_mobile?"my-sticky-dynamic table-top-ios":"android"===t.is_mobile?"my-sticky-dynamic table-top-android":"my-sticky-dynamic",attrs:{data:t.monthlyList,columns:t.columns,"row-key":"report_date",filter:t.filter,"binary-state-sort":"",pagination:t.pagination,"virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,"rows-per-page-options":[0]},on:{request:t.getMonthlyListByDriver,"update:pagination":function(e){t.pagination=e},"virtual-scroll":t.onScroll},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticClass:"row justify-end"},[a("q-input",{staticClass:"q-mb-sm",staticStyle:{width:"130px"},attrs:{dense:"","input-class":"text-white",color:"blue-7",label:"Start date","label-color":"white"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event",color:"white"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{minimal:"",mask:"DD/MM/YY ddd",color:"blue-7","first-day-of-week":"1"},model:{value:t.fromDate,callback:function(e){t.fromDate=e},expression:"fromDate"}},[a("div",{staticClass:"row items-center justify-end q-gutter-sm"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK",color:"blue-7",flat:""},on:{click:t.onFromDateChanged}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.fromDate,callback:function(e){t.fromDate=e},expression:"fromDate"}}),a("q-input",{staticClass:"q-ml-xs q-mb-sm",staticStyle:{width:"130px"},attrs:{dense:"","input-class":"text-white",color:"blue-7",label:"End date","label-color":"white"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event",color:"white"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{minimal:"",mask:"DD/MM/YY ddd",color:"blue-7","first-day-of-week":"1"},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}},[a("div",{staticClass:"row items-center justify-end q-gutter-sm"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK",color:"blue-7",flat:""},on:{click:t.onEndDateChanged}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}})],1)]},proxy:!0},{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"index",attrs:{props:e}},[t._v(t._s(e.row.index))]),a("q-td",{key:"report_date",staticClass:"text-uppercase",attrs:{props:e}},[t._v(t._s(t.changeDateFormat(e.row.report_date)))]),a("q-td",{key:"route_number",attrs:{props:e}},[t._v(t._s(e.row.route_number))]),a("q-td",{key:"pay_type",attrs:{props:e}},[t._v(t._s("fixed"===e.row.pay_type?"FIXED":"PAY PER STOP"))]),a("q-td",{key:"stops",attrs:{props:e}},[t._v(t._s("fixed"===e.row.pay_type?"-":e.row.stops))]),a("q-td",{key:"payment",attrs:{props:e}},[t._v(t._s(e.row.payment?"£"+e.row.payment:""))]),a("q-td",{key:"is_group",attrs:{props:e}},[t._v(t._s(1===e.row.is_group?"DAILY":"EXTRA"))])],1)]}},{key:"bottom",fn:function(){return[a("div",{staticClass:"col-12 row justify-between"},[a("div",{staticClass:"q-my-auto"}),a("div",{staticClass:"row justify-end items-center"},[t._v("\n              STOPS: "+t._s(t.totalStops())+"  \n              PAYMENT: "+t._s(t.totalPayment())+" £\n            ")])])]},proxy:!0}])})],1)]],2)},i=[],n=(a("c5f6"),a("a34a")),o=a.n(n),s=(a("96cf"),a("c973")),l=a.n(s),c=(a("28a5"),a("1e53")),d=a("f508"),p=a("bd4c");a("a357");var u={name:"MonthlyReportList",components:{},data:function(){return{filter:"",fromDate:"",fromDateAPI:"",endDate:"",endDateAPI:"",showDetail:!1,pagination:{sortBy:"report_date",descending:!0,page:1,rowsPerPage:100,rowsNumber:2e4},columns:[{name:"index",required:!0,label:"NO",align:"left",field:"index"},{name:"report_date",required:!0,label:"DATE",align:"left",field:"report_date"},{name:"route_number",required:!0,label:"ROUTE",align:"left",field:"route_number"},{name:"pay_type",required:!0,label:"PAY TYPE",align:"left",field:"pay_type"},{name:"stops",required:!0,label:"STOPS",align:"left",field:"stops"},{name:"payment",required:!0,label:"PAYMENT",align:"left",field:"payment"},{name:"is_group",required:!0,label:"TYPE",align:"left",field:"is_group"}],monthlyList:[],monthlyAll:[],selectedRoute:null,routeNumbers:[],is_mobile:"web",isDateFilter:!1}},computed:{driver:{get:function(){return this.$store.state.auth.driver}}},mounted:function(){var t=this;return l()(o.a.mark((function e(){return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.checkPlatform(),t.$store.commit("auth/pageTitle",t.$router.currentRoute.meta.title),t.fromDate=p["b"].formatDate(new Date,"DD/MM/YY ddd"),t.fromDateAPI=p["b"].formatDate(p["b"].startOfDate(new Date,"month"),"YYYY-MM-DD"),t.endDate=p["b"].formatDate(new Date,"DD/MM/YY ddd"),t.endDateAPI=p["b"].formatDate(new Date,"YYYY-MM-DD"),t.getMonthlyListByDriver({pagination:t.pagination,filter:void 0});case 7:case"end":return e.stop()}}),e)})))()},methods:{checkPlatform:function(){this.$q.platform.is.mobile?this.$q.platform.is.ios?this.is_mobile="ios":this.is_mobile="android":this.is_mobile="web"},changeDateFormat:function(t){var e=p["b"].formatDate(p["b"].addToDate(p["b"].extractDate(t,"YYYY-MM-DD"),{hours:5}),"DD-MM-YY dddd");return e},onFromDateChanged:function(t){this.fromDateAPI=p["b"].formatDate(p["b"].extractDate(this.fromDate,"DD/MM/YY ddd"),"YYYY-MM-DD"),this.isDateFilter=!0,this.pagination.page=1,this.getMonthlyListByDriver({pagination:this.pagination,filter:this.filter})},onEndDateChanged:function(t){this.endDateAPI=p["b"].formatDate(p["b"].extractDate(this.endDate,"DD/MM/YY ddd"),"YYYY-MM-DD"),this.isDateFilter=!0,this.pagination.page=1,this.getMonthlyListByDriver({pagination:this.pagination,filter:this.filter})},onScroll:function(t){var e=this;return l()(o.a.mark((function a(){var r,i,n,s,l,c,d;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=t.index,t.from,t.to,t.ref,i=e.pagination,n=i.page,s=i.rowsPerPage,l=i.rowsNumber,c=e.monthlyList.length-1,d=Math.ceil(l/s),!(r>0&&n<d&&r===c)){a.next=8;break}return e.pagination.page++,a.next=8,e.getMonthlyListByDriver({pagination:e.pagination,filter:e.filter,isScroll:!0});case 8:case"end":return a.stop()}}),a)})))()},getRouteAll:function(){var t=l()(o.a.mark((function t(){var e,a;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e={conditions:{driver_id:this.driver.id}},t.next=4,c["a"].getRouteAllByDriver(e);case 4:a=t.sent,this.routeNumbers=a.data.data,t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:case"end":return t.stop()}}),t,this,[[0,8]])})));function e(){return t.apply(this,arguments)}return e}(),onChangeRoute:function(){this.getMonthlyListByDriver({pagination:this.pagination,isScroll:!1})},getMonthlyListByDriver:function(){var t=l()(o.a.mark((function t(e){var a,r,i,n,s,l,p,u,m,f,h;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.pagination,r=a.page,i=a.rowsPerPage,n=a.rowsNumber,s=a.sortBy,l=a.descending,e.filter,p=e.isScroll,u=0===i?n:i,m=(r-1)*i,f={conditions:{is_date_filter:!0,driver_id:this.driver.id},start:m,numPerPage:u,sortBy:s,descending:l,fromDate:this.fromDateAPI,endDate:this.endDateAPI},this.selectedRoute&&(f.conditions.route_number=this.selectedRoute.route_number),this.isDateFilter||(f.conditions.is_date_filter=!1),d["a"].show(),t.prev=9,t.next=12,c["a"].getMonthlyReportsByDriver(f);case 12:h=t.sent,d["a"].hide(),h.data.data.forEach((function(t,e){t.index=100*(r-1)+e+1})),this.monthlyList=p?this.monthlyList.concat(h.data.data):h.data.data,this.pagination.rowsNumber=h.data.totalCount,this.pagination.page=r,this.pagination.rowsPerPage=i,this.pagination.sortBy=s,this.pagination.descending=l,t.next=27;break;case 23:t.prev=23,t.t0=t["catch"](9),d["a"].hide(),console.log("errorrrrrrrrrr",t.t0);case 27:case"end":return t.stop()}}),t,this,[[9,23]])})));function e(e){return t.apply(this,arguments)}return e}(),totalStops:function(){return this.monthlyList.reduce((function(t,e){return"per_stop"==e["current_paytype"]?t+Number(e["stops"]):t+0}),0)},totalPayment:function(){return this.monthlyList.reduce((function(t,e){return t+Number(e["payment"])}),0).toFixed(2)}},created:function(){}},m=u,f=(a("5b1f"),a("2877")),h=a("9989"),y=a("eaac"),D=a("ddd8"),b=a("0016"),g=a("27f9"),v=a("7cbe"),w=a("52ee"),_=a("9c40"),x=a("bd08"),Y=a("db86"),k=a("7f67"),q=a("eebe"),P=a.n(q),M=Object(f["a"])(m,r,i,!1,null,null,null);e["default"]=M.exports;P()(M,"components",{QPage:h["a"],QTable:y["a"],QSelect:D["a"],QIcon:b["a"],QInput:g["a"],QPopupProxy:v["a"],QDate:w["a"],QBtn:_["a"],QTr:x["a"],QTd:Y["a"]}),P()(M,"directives",{ClosePopup:k["a"]})},a76a:function(t,e,a){}}]);