(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{"8b60":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("q-page",[[r("div",[r("q-table",{class:"ios"===e.is_mobile?"my-sticky-dynamic table-top-ios":"android"===e.is_mobile?"my-sticky-dynamic table-top-android":"my-sticky-dynamic",attrs:{title:"MILAGE",data:e.driverMileageList,columns:"admin"===e.userLevel?e.columns_admin:e.columns,"row-key":"driver_name",pagination:e.pagination,filter:e.filter,"binary-state-sort":"","virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,"rows-per-page-options":[0]},on:{"update:pagination":function(t){e.pagination=t},request:e.getMileageRecords,"virtual-scroll":e.onScroll},scopedSlots:e._u([{key:"top-left",fn:function(){return[r("div",{staticClass:"items-center"},["driver"==e.userLevel?r("q-btn",{staticStyle:{width:"130px",height:"40px"},attrs:{rounded:"",dense:"","no-caps":"",label:"+Add Record",color:"blue-7"},on:{click:function(t){return e.createNew()}}}):e._e(),"driver"!==e.userLevel?r("q-select",{staticClass:"q-select-list",staticStyle:{"min-width":"130px"},attrs:{dense:"",options:e.vanNumbers,"option-value":function(e){return null==e?null:e},"option-label":function(e){return null==e?"- Null -":e.van_number},"bg-color":"transparent",color:"blue-7",label:"REG NO","label-color":"white",behavior:"menu"},on:{input:e.onChangeVan},scopedSlots:e._u([e.selectedVan?{key:"append",fn:function(){return[r("q-icon",{staticClass:"cursor-pointer text-white",attrs:{name:"cancel"},on:{click:[function(t){t.stopPropagation(),e.selectedVan=null},e.onChangeVan]}})]},proxy:!0}:null],null,!0),model:{value:e.selectedVan,callback:function(t){e.selectedVan=t},expression:"selectedVan"}}):e._e()],1)]},proxy:!0},{key:"top-right",fn:function(){return["driver"!==e.userLevel?r("q-select",{staticClass:"q-select-list",staticStyle:{"min-width":"130px"},attrs:{dense:"",options:e.drivers,"option-value":function(e){return null==e?null:e},"option-label":function(e){return null==e?"- Null -":e.driver_name},"bg-color":"transparent",color:"blue-7",label:"DRIVER","label-color":"white",behavior:"menu"},on:{input:e.onChangeDriver},scopedSlots:e._u([e.selectedDriver?{key:"append",fn:function(){return[r("q-icon",{staticClass:"cursor-pointer text-white",attrs:{name:"cancel"},on:{click:[function(t){t.stopPropagation(),e.selectedDriver=null},e.onChangeDriver]}})]},proxy:!0}:null],null,!0),model:{value:e.selectedDriver,callback:function(t){e.selectedDriver=t},expression:"selectedDriver"}}):e._e()]},proxy:!0},{key:"body",fn:function(t){return[r("q-tr",{attrs:{props:t},nativeOn:{click:function(r){return e.remove(t.row)}}},[r("q-td",{key:"index",attrs:{props:t}},[e._v(e._s(t.row.index))]),r("q-td",{key:"created_at",attrs:{props:t}},[e._v(e._s(e.changeDateFormat(t.row.created_at)))]),r("q-td",{key:"service_mileage",attrs:{props:t}},[e._v(e._s(t.row.service_mileage))]),r("q-td",{key:"van_number",attrs:{props:t}},[e._v(e._s(t.row.van_number))]),r("q-td",{key:"driver_name",attrs:{props:t}},[e._v(e._s(t.row.driver_name))]),r("q-td",{key:"tyres",attrs:{props:t}},[e._v(e._s(t.row.tyres?"YES":"NO"))]),r("q-td",{key:"oil",attrs:{props:t}},[e._v(e._s(t.row.oil?"YES":"NO"))]),"admin"===e.userLevel?r("q-td",{key:"user_name",attrs:{props:t}},[e._v(e._s(t.row.user.name))]):e._e()],1)]}},{key:"bottom",fn:function(){return[r("div",{staticClass:"col-12 row justify-between items-center"},[r("div",{staticClass:"q-my-auto"},["driver"!==e.userLevel?r("q-btn",{staticClass:"q-ma-none",staticStyle:{width:"60px",height:"30px"},attrs:{label:"Export","no-caps":"",dense:"",rounded:"",outline:""},on:{click:e.exportTable}}):e._e()],1),r("div",{staticClass:"row justify-end items-center"},[e._v("\n              Total Records: "+e._s(e.pagination.rowsNumber)+"\n            ")])])]},proxy:!0}])})],1)]],2)},i=[],a=r("a34a"),s=r.n(a),l=(r("96cf"),r("c973")),o=r.n(l),c=(r("28a5"),r("1e53")),u=r("f508"),d=r("bd4c"),p=r("a357");function v(e,t){var r=void 0!==t?t(e):e;return r=void 0===r||null===r?"":String(r),r=r.split('"').join('""'),'"'.concat(r,'"')}var m={name:"MileageRecordList",data:function(){return{filter:"",pagination:{sortBy:"driver_name",descending:!1,page:1,rowsPerPage:100,rowsNumber:20},columns:[{name:"index",required:!0,label:"NO",align:"left",field:"index"},{name:"created_at",required:!0,label:"DATE",align:"left",field:"created_at"},{name:"service_mileage",required:!0,label:"MILEAGE",align:"left",field:"service_mileage"},{name:"van_number",required:!0,label:"REG NO",align:"left",field:"van_number"},{name:"driver_name",required:!0,label:"DRIVER",align:"left",field:"driver_name"},{name:"oil",required:!0,label:"OIL",align:"left",field:"oil"},{name:"tyres",required:!0,label:"TYRES",align:"left",field:"tyres"}],columns_admin:[{name:"index",required:!0,label:"NO",align:"left",field:"index"},{name:"created_at",required:!0,label:"DATE",align:"left",field:"created_at"},{name:"service_mileage",required:!0,label:"MILEAGE",align:"left",field:"service_mileage"},{name:"van_number",required:!0,label:"REG NO",align:"left",field:"van_number"},{name:"driver_name",required:!0,label:"DRIVER",align:"left",field:"driver_name"},{name:"oil",required:!0,label:"OIL",align:"left",field:"oil"},{name:"tyres",required:!0,label:"TYRES",align:"left",field:"tyres"},{name:"user_name",required:!0,label:"USER",align:"left",field:"user_name"}],driverMileageList:[],mileageAll:[],is_mobile:"web",selectedVan:null,vanNumbers:[],selectedDriver:null,drivers:[],isNewRecord:!0}},computed:{userLevel:{get:function(){return this.$store.state.auth.userLevel}},driver:{get:function(){return this.$store.state.auth.driver}}},mounted:function(){var e=this;return o()(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.checkPlatform(),e.$store.commit("auth/pageTitle",e.$router.currentRoute.meta.title),"driver"==e.userLevel){t.next=7;break}return t.next=5,e.getVanNumbers();case 5:return t.next=7,e.getDriverAll();case 7:return t.next=9,e.getMileageRecords({pagination:e.pagination,filter:void 0});case 9:case"end":return t.stop()}}),t)})))()},methods:{checkPlatform:function(){this.$q.platform.is.mobile?this.$q.platform.is.ios?this.is_mobile="ios":this.is_mobile="android":this.is_mobile="web"},createNew:function(){this.$router.push({name:"New Odometer Record"})},changeDateFormat:function(e){return e=e.slice(0,-8),d["b"].formatDate(d["b"].extractDate(e,"YYYY-MM-DDTHH:mm:ss"),"DD/MM/YY - HH:mm")},getVanNumbers:function(){var e=o()(s.a.mark((function e(){var t;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c["a"].getFleetAll();case 3:t=e.sent,this.vanNumbers=t.data.data,e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](0);case 9:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}(),getDriverAll:function(){var e=o()(s.a.mark((function e(){var t;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c["a"].getMileageDrivers();case 3:t=e.sent,this.drivers=t.data.data,e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](0);case 9:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}(),onChangeVan:function(){this.getMileageRecords({pagination:this.pagination,isScroll:!1})},onChangeDriver:function(){this.getMileageRecords({pagination:this.pagination,isScroll:!1})},goToDetail:function(e){e.is_first||"driver"!==this.userLevel||this.$router.push({name:"Odometer Record Details",params:{id:e.id}})},onScroll:function(e){var t=this;return o()(s.a.mark((function r(){var n,i,a,l,o,c,u;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=e.index,e.from,e.to,e.ref,i=t.pagination,a=i.page,l=i.rowsPerPage,o=i.rowsNumber,c=t.driverMileageList.length-1,u=Math.ceil(o/l),!(n>0&&a<u&&n===c)){r.next=8;break}return t.pagination.page++,r.next=8,t.getMileageRecords({pagination:t.pagination,filter:t.filter,isScroll:!0});case 8:case"end":return r.stop()}}),r)})))()},getMileageRecords:function(){var e=o()(s.a.mark((function e(t){var r,n,i,a,l,o,d,p,v,m,f;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.pagination,n=r.page,i=r.rowsPerPage,a=r.rowsNumber,l=r.sortBy,o=r.descending,t.filter,d=t.isScroll,p=0===i?a:i,v=(n-1)*i,m={conditions:{},start:v,numPerPage:p,sortBy:l,descending:o,showAll:!0},this.selectedVan&&(m.conditions.van_number=this.selectedVan.van_number),this.selectedDriver&&(m.conditions.driver_name=this.selectedDriver.driver_name),"driver"===this.userLevel&&(m.driver_id=this.driver.id),u["a"].show(),e.prev=10,e.next=13,c["a"].getMileageRecords(m);case 13:f=e.sent,u["a"].hide(),f.data.data.forEach((function(e,t){e.index=10*(n-1)+t+1})),this.driverMileageList=d?this.driverMileageList.concat(f.data.data):f.data.data,this.pagination.rowsNumber=f.data.totalCount,this.pagination.page=n,this.pagination.rowsPerPage=i,this.pagination.sortBy=l,this.pagination.descending=o,e.next=27;break;case 24:e.prev=24,e.t0=e["catch"](10),u["a"].hide();case 27:case"end":return e.stop()}}),e,this,[[10,24]])})));function t(t){return e.apply(this,arguments)}return t}(),remove:function(e){var t=this;this.$q.dialog({title:"Confirm",message:"Are you surely remove this odometer record?",cancel:!0,persistent:!0}).onOk(o()(s.a.mark((function r(){var n,i;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n={conditions:{id:e.id}},u["a"].show(),r.prev=2,r.next=5,c["a"].removeMileageRecord(n);case 5:i=r.sent,t.getMileageRecords({pagination:t.pagination,filter:t.filter,isScroll:!1}),u["a"].hide(),console.log("remove result",i),t.$q.notify({color:"positive",position:"top",message:"Odometer Record is removed successfully !"}),r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](2),u["a"].hide();case 15:case"end":return r.stop()}}),r,null,[[2,12]])})))).onCancel((function(){})).onDismiss((function(){}))},exportTable:function(){var e=this;return o()(s.a.mark((function t(){var r,n,i;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getMileageAll({filter:e.filter});case 2:r=e.columns,n=[r.map((function(e){return v(e.label)}))].concat(e.mileageAll.map((function(e){return r.map((function(t){return"tyres"===t.field?v("1"===e.tyres?"YES":"NO",t.format):"oil"===t.field?v("1"===e.oil?"YES":"NO",t.format):v(e[t.field],t.format)})).join(",")}))).join("\r\n"),i=Object(p["a"])("table-export.csv",n,"text/csv"),!0!==i&&e.$q.notify({message:"Browser denied file download...",color:"negative",icon:"warning"});case 6:case"end":return t.stop()}}),t)})))()},getMileageAll:function(){var e=o()(s.a.mark((function e(t){var r,n,i;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.filter,n={conditions:{}},r&&(n.conditions.filter=r),"driver"===this.userLevel&&(n.driver_id=this.driver.id),u["a"].show(),e.prev=5,e.next=8,c["a"].getMileageAll(n);case 8:i=e.sent,u["a"].hide(),i.data.data.forEach((function(e,t){e.index=t+1})),this.mileageAll=i.data.data,e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](5),u["a"].hide();case 17:case"end":return e.stop()}}),e,this,[[5,14]])})));function t(t){return e.apply(this,arguments)}return t}()},created:function(){}},f=m,g=(r("a2d7"),r("2877")),h=r("9989"),b=r("eaac"),w=r("9c40"),_=r("ddd8"),y=r("0016"),x=r("27f9"),k=r("bd08"),q=r("db86"),D=r("eebe"),R=r.n(D),M=Object(g["a"])(f,n,i,!1,null,null,null);t["default"]=M.exports;R()(M,"components",{QPage:h["a"],QTable:b["a"],QBtn:w["a"],QSelect:_["a"],QIcon:y["a"],QInput:x["a"],QTr:k["a"],QTd:q["a"]})},a2d7:function(e,t,r){"use strict";var n=r("e259"),i=r.n(n);i.a},e259:function(e,t,r){}}]);