(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[34],{"940e":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",[[n("div",[n("q-table",{class:"ios"===e.is_mobile?"my-sticky-dynamic table-top-ios":"android"===e.is_mobile?"my-sticky-dynamic table-top-android":"my-sticky-dynamic",attrs:{data:e.dpdPerformanceList,columns:e.columns,"row-key":"dpdDate",filter:e.filter,"binary-state-sort":"",pagination:e.pagination,"virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,"rows-per-page-options":[0]},on:{request:e.getDpdPerformanceList,"update:pagination":function(t){e.pagination=t},"virtual-scroll":e.onScroll},scopedSlots:e._u([{key:"top",fn:function(){return[n("div",{staticClass:"col-6 row justify-start"},[n("q-select",{staticClass:"q-ml-xs q-select-list",staticStyle:{"min-width":"130px"},attrs:{dense:"",options:e.dpdRouteNumbers,"option-value":function(e){return null==e?null:e},"option-label":function(e){return null==e?"- Null -":e.dpdRoute},"bg-color":"transparent",color:"blue-7",label:"ROUTE","label-color":"white","text-color":"white",behavior:"menu"},on:{input:e.onChangeRoute},scopedSlots:e._u([e.selectedDpdRoute?{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer text-white",attrs:{name:"cancel"},on:{click:[function(t){t.stopPropagation(),e.selectedDpdRoute=null},e.onChangeRoute]}})]},proxy:!0}:null],null,!0),model:{value:e.selectedDpdRoute,callback:function(t){e.selectedDpdRoute=t},expression:"selectedDpdRoute"}})],1),n("div",{staticClass:"col-6 row justify-end"},[n("q-select",{staticClass:"q-select-list",attrs:{dense:"",options:e.periods,"option-value":function(e){return null==e?null:e},"option-label":function(e){return null==e?"- Null -":e.duration},"bg-color":"transparent",color:"blue-7","label-color":"white",behavior:"menu"},on:{input:e.onChangePeriod},model:{value:e.selectedPeriod,callback:function(t){e.selectedPeriod=t},expression:"selectedPeriod"}})],1)]},proxy:!0},{key:"body",fn:function(t){return[n("q-tr",{attrs:{props:t},nativeOn:{click:function(n){return e.goToDetail(t.row)}}},[n("q-td",{key:"index",attrs:{props:t}},[e._v(e._s(t.row.index))]),n("q-td",{key:"dpdDate",staticClass:"text-uppercase",attrs:{props:t}},[e._v(e._s(e.changeDateFormat(t.row.dpdDate)))]),n("q-td",{key:"dpdRoute",attrs:{props:t}},[e._v(e._s(t.row.dpdRoute))]),n("q-td",{key:"dpdStops",attrs:{props:t}},[e._v(e._s(t.row.dpdStops))]),n("q-td",{key:"dpdPayment",attrs:{props:t}},[e._v(e._s(t.row.dpdPayment?"£"+t.row.dpdPayment:""))])],1)]}},{key:"bottom",fn:function(){return[n("div",{staticClass:"col-12 row justify-between"},[n("div",{staticClass:"q-my-auto"}),n("div",{staticClass:"row justify-end items-center"},[e._v("\n              STOPS: "+e._s(e.totalStops())+"  \n              PAYMENT: "+e._s(e.totalPayment())+" £\n            ")])])]},proxy:!0}])})],1)]],2)},a=[],i=(n("c5f6"),n("a34a")),o=n.n(i),s=(n("96cf"),n("c973")),d=n.n(s),c=(n("28a5"),n("1e53")),l=n("f508"),u=n("bd4c");n("a357");var p={name:"DpdPerformanceList",components:{},data:function(){return{filter:"",fromDate:"",fromDateAPI:"",endDate:"",endDateAPI:"",pagination:{sortBy:"dpdDate",descending:!0,page:1,rowsPerPage:100,rowsNumber:2e4},columns:[{name:"index",required:!0,label:"NO",align:"left",field:"index"},{name:"dpdDate",required:!0,label:"DATE",align:"left",field:"dpdDate"},{name:"dpdRoute",required:!0,label:"ROUTE",align:"left",field:"dpdRoute"},{name:"dpdStops",required:!0,label:"STOPS",align:"left",field:"dpdStops"},{name:"dpdPayment",required:!0,label:"PAYMENT",align:"left",field:"dpdPayment"}],dpdPerformanceList:[],dpdPerformanceAll:[],is_mobile:"web",isDateFilter:!1,selectedPeriod:{},periods:[],selectedDpdRoute:null,dpdRouteNumbers:[]}},computed:{userLevel:{get:function(){return this.$store.state.auth.userLevel}},driver:{get:function(){return this.$store.state.auth.driver}}},mounted:function(){var e=this;return d()(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.checkPlatform(),e.$store.commit("auth/pageTitle",e.$router.currentRoute.meta.title),t.next=4,e.getDpdRouteAll();case 4:return t.next=6,e.getPeriods();case 6:e.getDpdPerformanceList({pagination:e.pagination,filter:void 0});case 7:case"end":return t.stop()}}),t)})))()},methods:{checkPlatform:function(){this.$q.platform.is.mobile?this.$q.platform.is.ios?this.is_mobile="ios":this.is_mobile="android":this.is_mobile="web"},getDpdRouteAll:function(){var e=d()(o.a.mark((function e(){var t;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c["a"].getDpdRouteAll();case 3:t=e.sent,this.dpdRouteNumbers=t.data.data,e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](0);case 9:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}(),getPeriods:function(){var e=this;return d()(o.a.mark((function t(){var n,r;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return l["a"].show(),t.prev=1,n=u["b"].formatDate(new Date,"YYYY-MM-DD"),t.next=5,c["a"].getPeriods(n);case 5:r=t.sent,l["a"].hide(),e.periods=r.data.data,e.periods.length&&(e.selectedPeriod=e.periods.filter((function(e){if(e.firstTransactionDate<=n&&e.lastTransactionDate>=n)return e}))[0]),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](1),console.log("get periods error",t.t0),l["a"].hide();case 15:case"end":return t.stop()}}),t,null,[[1,11]])})))()},changeDateFormat:function(e){var t=u["b"].formatDate(u["b"].addToDate(u["b"].extractDate(e,"YYYY-MM-DD"),{hours:5}),"DD-MM-YY dddd");return t},onChangePeriod:function(){var e=this;return d()(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isDateFilter=!0,t.next=3,e.getDpdPerformanceList({pagination:e.pagination,filter:e.filter,isScroll:!1});case 3:case"end":return t.stop()}}),t)})))()},goToDetail:function(e){var t=this;return d()(o.a.mark((function n(){return o.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e&&t.$router.push({name:"Edit DPD Modules",params:{dpdDate:e.dpdDate}});case 1:case"end":return n.stop()}}),n)})))()},onScroll:function(e){var t=this;return d()(o.a.mark((function n(){var r,a,i,s,d,c,l;return o.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.index,e.from,e.to,e.ref,a=t.pagination,i=a.page,s=a.rowsPerPage,d=a.rowsNumber,c=t.dpdPerformanceList.length-1,l=Math.ceil(d/s),!(r>0&&i<l&&r===c)){n.next=8;break}return t.pagination.page++,n.next=8,t.getDpdPerformanceList({pagination:t.pagination,filter:t.filter,isScroll:!0});case 8:case"end":return n.stop()}}),n)})))()},onChangeDriver:function(){this.getDpdPerformanceList({pagination:this.pagination,isScroll:!1})},onChangeRoute:function(){this.getDpdPerformanceList({pagination:this.pagination,isScroll:!1})},getDpdPerformanceList:function(){var e=d()(o.a.mark((function e(t){var n,r,a,i,s,d,u,p,f,m,h;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.pagination,r=n.page,a=n.rowsPerPage,i=n.rowsNumber,s=n.sortBy,d=n.descending,t.filter,u=t.isScroll,p=0===a?i:a,f=(r-1)*a,m={conditions:{is_date_filter:!0,driver_id:this.driver.id},start:f,numPerPage:p,sortBy:s,descending:d,fromDate:"",endDate:""},this.selectedDpdRoute&&(m.conditions.dpdRoute=this.selectedDpdRoute.dpdRoute),this.isDateFilter?(m.fromDate=this.selectedPeriod.firstTransactionDate,m.endDate=this.selectedPeriod.lastTransactionDate):m.conditions.is_date_filter=!1,l["a"].show(),e.prev=9,e.next=12,c["a"].getDpdDriverPerformanceList(m);case 12:h=e.sent,l["a"].hide(),h.data.data.forEach((function(e,t){e.index=100*(r-1)+t+1})),this.dpdPerformanceList=u?this.dpdPerformanceList.concat(h.data.data):h.data.data,this.pagination.rowsNumber=h.data.totalCount,this.pagination.page=r,this.pagination.rowsPerPage=a,this.pagination.sortBy=s,this.pagination.descending=d,e.next=27;break;case 23:e.prev=23,e.t0=e["catch"](9),l["a"].hide(),console.log("errorrrrrrrrrr",e.t0);case 27:case"end":return e.stop()}}),e,this,[[9,23]])})));function t(t){return e.apply(this,arguments)}return t}(),totalStops:function(){return this.dpdPerformanceList.reduce((function(e,t){return"per_stop"==t["dpdPayType"]?e+Number(t["dpdStops"]):e+0}),0)},totalPayment:function(){return this.dpdPerformanceList.reduce((function(e,t){return e+Number(t["dpdPayment"])}),0).toFixed(2)}},created:function(){}},f=p,m=n("2877"),h=n("9989"),g=n("eaac"),D=n("ddd8"),v=n("0016"),b=n("bd08"),w=n("db86"),P=n("9c40"),y=n("eebe"),x=n.n(y),k=Object(m["a"])(f,r,a,!1,null,null,null);t["default"]=k.exports;x()(k,"components",{QPage:h["a"],QTable:g["a"],QSelect:D["a"],QIcon:v["a"],QTr:b["a"],QTd:w["a"],QBtn:P["a"]})}}]);