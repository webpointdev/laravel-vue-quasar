(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{"3db5":function(t,e,a){},"4b57":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",[[a("div",[a("q-table",{class:"ios"===t.is_mobile?"my-sticky-dynamic table-top-ios":"android"===t.is_mobile?"my-sticky-dynamic table-top-android":"my-sticky-dynamic",attrs:{data:t.reportList,columns:"admin"===t.userLevel?t.columns_admin:t.columns,"row-key":"report_date",filter:t.filter,"binary-state-sort":"",pagination:t.pagination,"virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,"rows-per-page-options":[0]},on:{request:t.getReportList,"update:pagination":function(e){t.pagination=e},"virtual-scroll":t.onScroll},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticClass:"col-6 row justify-start"},[a("q-btn",{staticStyle:{width:"130px",height:"40px"},attrs:{color:"blue-7",label:"+Add Record","no-caps":"",dense:"",rounded:""},on:{click:t.showAddRecordDlg}})],1),a("div",{staticClass:"col-6 row justify-end"},[a("q-input",{staticClass:"q-mb-sm",staticStyle:{width:"130px"},attrs:{dense:"","input-class":"text-white",color:"blue-7",label:"Start date","label-color":"white"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event",color:"white"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{minimal:"",mask:"DD/MM/YY ddd",color:"blue-7","first-day-of-week":"1"},model:{value:t.fromDate,callback:function(e){t.fromDate=e},expression:"fromDate"}},[a("div",{staticClass:"row items-center justify-end q-gutter-sm"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK",color:"blue-7",flat:""},on:{click:t.onFromDateChanged}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.fromDate,callback:function(e){t.fromDate=e},expression:"fromDate"}}),a("q-input",{staticClass:"q-ml-xs q-mb-sm",staticStyle:{width:"130px"},attrs:{dense:"","input-class":"text-white",color:"blue-7",label:"End date","label-color":"white"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event",color:"white"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{minimal:"",mask:"DD/MM/YY ddd",color:"blue-7","first-day-of-week":"1"},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}},[a("div",{staticClass:"row items-center justify-end q-gutter-sm"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK",color:"blue-7",flat:""},on:{click:t.onEndDateChanged}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}})],1)]},proxy:!0},{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e},nativeOn:{click:function(a){1===e.row.is_group?t.goToDailyDetail(e.row):t.goToExtraDetail(e.row)}}},[a("q-td",{key:"no",attrs:{props:e}},[t._v(t._s(e.row.index))]),a("q-td",{key:"report_date",staticClass:"text-uppercase",attrs:{props:e}},[t._v(t._s(t.changeDateFormat(e.row.report_date)))]),a("q-td",{key:"is_group",attrs:{props:e}},[t._v(t._s(1===e.row.is_group?"DAILY":"EXTRA")+" ("+t._s(e.row.route_count)+")")]),"admin"===t.userLevel?a("q-td",{key:"full_name",attrs:{props:e}},[t._v(t._s(e.row.user.name))]):t._e(),a("q-td",{key:"buttons",attrs:{props:e}},[a("q-btn",{attrs:{rounded:"",flat:"",icon:"fas fa-pen-alt"},on:{click:function(a){1===e.row.is_group?t.goToDailyDetail(e.row):t.goToExtraDetail(e.row)}},nativeOn:{click:function(t){t.stopPropagation()}}})],1)],1)]}},{key:"bottom",fn:function(){return[a("div",{staticClass:"col-12 row justify-between"},[a("div",{staticClass:"q-my-auto"}),a("div",{staticClass:"row justify-end items-center"},[t._v("\n              Total Records: "+t._s(t.pagination.rowsNumber)+"\n            ")])])]},proxy:!0}])})],1),a("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.showAddDlg,callback:function(e){t.showAddDlg=e},expression:"showAddDlg"}},[a("q-card",{staticStyle:{"background-color":"#3E444E","max-width":"500px","min-width":"352px","min-height":"330px"}},[a("q-bar",{staticStyle:{"background-color":"#272B33"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close",color:"white"}},[a("q-tooltip",{attrs:{"content-class":"bg-white text-black"}},[t._v("Close")])],1)],1),a("q-separator"),a("div",[a("q-card-section",[a("div",{staticClass:"text-h6 text-white text-center"},[t._v("What kind of record do you want to add?")])]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-option-group",{staticClass:"q-mx-auto text-white",staticStyle:{width:"140px"},attrs:{options:t.add_options,type:"radio",size:"xl",color:"white","keep-color":""},model:{value:t.selectedOption,callback:function(e){t.selectedOption=e},expression:"selectedOption"}})],1),a("q-card-section",{staticClass:"text-center q-py-none"},[a("q-btn",{staticClass:"q-mt-xs",staticStyle:{width:"100px",height:"40px"},attrs:{label:"Add",color:"blue-7","no-caps":"",dense:"",rounded:""},on:{click:t.addRecord}})],1)],1)],1)],1)]],2)},i=[],r=a("a34a"),n=a.n(r),s=(a("96cf"),a("c973")),l=a.n(s),c=(a("28a5"),a("1e53")),d=a("f508"),p=a("bd4c"),u=a("a357");function f(t,e){console.log("csv",t);var a=void 0!==e?e(t):t;return a=void 0===a||null===a?"":String(a),a=a.split('"').join('""'),'"'.concat(a,'"')}var m={name:"ReportList",data:function(){return{filter:"",showAddDlg:!1,add_options:[{label:"DAILY",value:"daily"},{label:"EXTRA",value:"extra"}],selectedOption:"",pagination:{sortBy:"report_date",descending:!0,page:1,rowsPerPage:100,rowsNumber:20},fromDate:"",fromDateAPI:"",endDate:"",endDateAPI:"",columns:[{name:"no",required:!0,label:"NO",align:"left",field:"no"},{name:"report_date",required:!0,label:"DATE",align:"left",field:"report_date"},{name:"is_group",required:!0,label:"TYPE",align:"left",field:"is_group"},{name:"buttons",label:"",field:"buttons"}],columns_admin:[{name:"no",required:!0,label:"NO",align:"left",field:"no"},{name:"report_date",required:!0,label:"DATE",align:"left",field:"report_date"},{name:"is_group",required:!0,label:"TYPE",align:"left",field:"is_group"},{name:"full_name",required:!0,label:"USER",align:"left",field:"full_name"},{name:"buttons",label:"",field:"buttons"}],reportList:[],is_mobile:"web",rnc_id:"",isDateFilter:!1,showEmptyConfirm:!1}},computed:{userLevel:{get:function(){return this.$store.state.auth.userLevel}}},mounted:function(){var t=this;return l()(n.a.mark((function e(){return n.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.checkPlatform(),t.$store.commit("auth/pageTitle",t.$router.currentRoute.meta.title),t.fromDate=p["b"].formatDate(new Date,"DD/MM/YY ddd"),t.fromDateAPI=p["b"].formatDate(p["b"].startOfDate(new Date,"month"),"YYYY-MM-DD"),t.endDate=p["b"].formatDate(new Date,"DD/MM/YY ddd"),t.endDateAPI=p["b"].formatDate(new Date,"YYYY-MM-DD"),e.next=8,t.getReportList({pagination:t.pagination,filter:void 0});case 8:case"end":return e.stop()}}),e)})))()},methods:{checkPlatform:function(){this.$q.platform.is.mobile?this.$q.platform.is.ios?this.is_mobile="ios":this.is_mobile="android":this.is_mobile="web"},changeDateFormat:function(t){var e=p["b"].formatDate(p["b"].addToDate(p["b"].extractDate(t,"YYYY-MM-DD"),{hours:5}),"DD-MM-YY ddd");return e},showAddRecordDlg:function(){this.showAddDlg=!0},hideAddRecordDlg:function(){this.showAddDlg=!1,this.selectedOption=""},onFromDateChanged:function(t){this.fromDateAPI=p["b"].formatDate(p["b"].extractDate(this.fromDate,"DD/MM/YY ddd"),"YYYY-MM-DD"),this.isDateFilter=!0,this.pagination.page=1,this.getReportList({pagination:this.pagination,filter:this.filter})},onEndDateChanged:function(t){this.endDateAPI=p["b"].formatDate(p["b"].extractDate(this.endDate,"DD/MM/YY ddd"),"YYYY-MM-DD"),this.isDateFilter=!0,this.pagination.page=1,this.getReportList({pagination:this.pagination,filter:this.filter})},exportTable:function(){var t="admin"===this.userLevel?this.columns_admin:this.columns,e=[t.map((function(t){return f(t.label)}))].concat(this.reportList.map((function(e){return t.map((function(t){return"is_group"===t.field?f(1===e.is_group?"DAILY":"EXTRA",t.format):"user_name"===t.field?f(e.user.full_name,t.format):"report_date"===t.field?f(e.report_date,t.format):f(e[t.field],t.format)})).join(",")}))).join("\r\n"),a=Object(u["a"])("table-export.csv",e,"text/csv");!0!==a&&this.$q.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},addRecord:function(){"extra"===this.selectedOption?this.goToExtraDetail():"daily"===this.selectedOption&&this.goToDailyDetail()},goToExtraDetail:function(t){var e=this;return l()(n.a.mark((function a(){return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t?e.$router.push({name:"Edit Extra Schedule",params:{reportNo:t.report_no}}):e.$router.push({name:"New Extra Schedule"});case 1:case"end":return a.stop()}}),a)})))()},goToDailyDetail:function(t){var e=this;return l()(n.a.mark((function a(){return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t?e.$router.push({name:"Edit Daily Schedule",params:{reportNo:t.report_no}}):e.$router.push({name:"New Daily Schedule"});case 1:case"end":return a.stop()}}),a)})))()},removeSelectedDriver:function(t){this.dailyReportForm.report_data[t].driver_id=""},onScroll:function(t){var e=this;return l()(n.a.mark((function a(){var o,i,r,s,l,c,d;return n.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=t.index,t.from,t.to,t.ref,i=e.pagination,r=i.page,s=i.rowsPerPage,l=i.rowsNumber,c=e.reportList.length-1,d=Math.ceil(l/s),!(o>0&&r<d&&o===c)){a.next=8;break}return e.pagination.page++,a.next=8,e.getReportList({pagination:e.pagination,filter:e.filter,isScroll:!0});case 8:case"end":return a.stop()}}),a)})))()},getReportList:function(){var t=l()(n.a.mark((function t(e){var a,o,i,r,s,l,p,u,f,m,h,D;return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.pagination,o=a.page,i=a.rowsPerPage,r=a.rowsNumber,s=a.sortBy,l=a.descending,p=e.filter,u=e.isScroll,f=0===i?r:i,m=(o-1)*i,h={conditions:{is_date_filter:!0},start:m,numPerPage:f,sortBy:s,descending:l,fromDate:this.fromDateAPI,endDate:this.endDateAPI},p&&(h.conditions.filter=p),this.isDateFilter||(h.conditions.is_date_filter=!1),d["a"].show(),t.prev=9,t.next=12,c["a"].getReports(h);case 12:D=t.sent,d["a"].hide(),D.data.data.forEach((function(t,e){t.index=100*(o-1)+e+1})),this.reportList=u?this.reportList.concat(D.data.data):D.data.data,this.pagination.rowsNumber=D.data.totalCount,this.pagination.page=o,this.pagination.rowsPerPage=i,this.pagination.sortBy=s,this.pagination.descending=l,t.next=26;break;case 23:t.prev=23,t.t0=t["catch"](9),d["a"].hide();case 26:case"end":return t.stop()}}),t,this,[[9,23]])})));function e(e){return t.apply(this,arguments)}return e}()},created:function(){}},h=m,D=(a("ee35"),a("2877")),g=a("9989"),b=a("eaac"),w=a("9c40"),v=a("27f9"),x=a("0016"),y=a("7cbe"),_=a("52ee"),q=a("bd08"),k=a("db86"),Y=a("24e8"),P=a("f09f"),A=a("d847"),C=a("05c0"),M=a("eb85"),E=a("a370"),S=a("9f0a"),T=a("7f67"),L=a("eebe"),R=a.n(L),O=Object(D["a"])(h,o,i,!1,null,null,null);e["default"]=O.exports;R()(O,"components",{QPage:g["a"],QTable:b["a"],QBtn:w["a"],QInput:v["a"],QIcon:x["a"],QPopupProxy:y["a"],QDate:_["a"],QTr:q["a"],QTd:k["a"],QDialog:Y["a"],QCard:P["a"],QBar:A["a"],QTooltip:C["a"],QSeparator:M["a"],QCardSection:E["a"],QOptionGroup:S["a"]}),R()(O,"directives",{ClosePopup:T["a"]})},ee35:function(t,e,a){"use strict";var o=a("3db5"),i=a.n(o);i.a}}]);