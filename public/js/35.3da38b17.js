(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[35],{a1b3:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("q-page",[[r("div",[r("q-table",{class:"ios"===e.is_mobile?"my-sticky-dynamic table-top-ios":"android"===e.is_mobile?"my-sticky-dynamic table-top-android":"my-sticky-dynamic",attrs:{data:e.dpdPerformanceList,columns:e.columns,"row-key":"dpdDate",filter:e.filter,"binary-state-sort":"",pagination:e.pagination,"virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,"rows-per-page-options":[0]},on:{request:e.getDpdPerformanceList,"update:pagination":function(t){e.pagination=t},"virtual-scroll":e.onScroll},scopedSlots:e._u([{key:"top",fn:function(){return[r("div",{staticClass:"col-6 row justify-start"},[r("q-select",{staticClass:"text-white q-mr-xs q-select-list",staticStyle:{"min-width":"130px"},attrs:{dense:"",options:e.driverNames,"option-value":function(e){return null==e?null:e},"option-label":function(e){return null==e?"- Null -":e.driver_name},"bg-color":"transparent",color:"blue-7",label:"DRIVER","label-color":"white",behavior:"menu"},on:{input:e.onChangeDriver},scopedSlots:e._u([e.selectedDriver?{key:"append",fn:function(){return[r("q-icon",{staticClass:"cursor-pointer text-white",attrs:{name:"cancel"},on:{click:[function(t){t.stopPropagation(),e.selectedDriver=null},e.onChangeDriver]}})]},proxy:!0}:null],null,!0),model:{value:e.selectedDriver,callback:function(t){e.selectedDriver=t},expression:"selectedDriver"}}),r("q-select",{staticClass:"q-select-list",staticStyle:{"min-width":"130px"},attrs:{dense:"",options:e.dpdRouteNumbers,"option-value":function(e){return null==e?null:e},"option-label":function(e){return null==e?"- Null -":e.dpdRoute},"bg-color":"transparent",color:"blue-7",label:"ROUTE","label-color":"white","text-color":"white",behavior:"menu"},on:{input:e.onChangeRoute},scopedSlots:e._u([e.selectedDpdRoute?{key:"append",fn:function(){return[r("q-icon",{staticClass:"cursor-pointer text-white",attrs:{name:"cancel"},on:{click:[function(t){t.stopPropagation(),e.selectedDpdRoute=null},e.onChangeRoute]}})]},proxy:!0}:null],null,!0),model:{value:e.selectedDpdRoute,callback:function(t){e.selectedDpdRoute=t},expression:"selectedDpdRoute"}})],1),r("div",{staticClass:"col-6 row justify-end"},[r("q-select",{staticClass:"q-select-list",attrs:{dense:"",options:e.periods,"option-value":function(e){return null==e?null:e},"option-label":function(e){return null==e?"- Null -":e.duration},"bg-color":"transparent",color:"blue-7","label-color":"white",behavior:"menu"},on:{input:e.onChangePeriod},model:{value:e.selectedPeriod,callback:function(t){e.selectedPeriod=t},expression:"selectedPeriod"}})],1)]},proxy:!0},{key:"body",fn:function(t){return[r("q-tr",{attrs:{props:t},nativeOn:{click:function(r){return e.goToDetail(t.row)}}},[r("q-td",{key:"index",attrs:{props:t}},[e._v(e._s(t.row.index))]),r("q-td",{key:"dpdDate",staticClass:"text-uppercase",attrs:{props:t}},[e._v(e._s(e.changeDateFormat(t.row.dpdDate)))]),r("q-td",{key:"dpdRoute",attrs:{props:t}},[e._v(e._s(t.row.dpdRoute))]),r("q-td",{key:"driver_name",attrs:{props:t}},[e._v(e._s(t.row.driver_name))]),r("q-td",{key:"dpdPayType",attrs:{props:t}},[e._v(e._s("fixed"===t.row.dpdPayType?"FIXED":"PAY PER STOP"))]),r("q-td",{key:"dpdStops",attrs:{props:t}},[e._v(e._s(t.row.dpdStops))]),r("q-td",{key:"dpdPayment",attrs:{props:t}},[e._v(e._s(t.row.dpdPayment?"£"+t.row.dpdPayment:""))])],1)]}},{key:"bottom",fn:function(){return[r("div",{staticClass:"col-12 row justify-between"},[r("div",{staticClass:"q-my-auto"},[r("q-btn",{staticClass:"q-ma-none",staticStyle:{width:"60px",height:"30px"},attrs:{label:"Export","no-caps":"",dense:"",rounded:"",outline:""},on:{click:e.exportTable}})],1),r("div",{staticClass:"row justify-end items-center"},[e._v("\n              STOPS: "+e._s(e.totalStops())+"  \n              PAYMENT: "+e._s(e.totalPayment())+" £\n            ")])])]},proxy:!0}])})],1)]],2)},a=[],i=(r("c5f6"),r("a34a")),o=r.n(i),s=(r("96cf"),r("c973")),d=r.n(s),l=(r("28a5"),r("1e53")),c=r("f508"),u=r("bd4c"),p=r("a357");function f(e,t){var r=void 0!==t?t(e):e;return r=void 0===r||null===r?"":String(r),r=r.split('"').join('""'),'"'.concat(r,'"')}var m={name:"DpdPerformanceList",components:{},data:function(){return{filter:"",fromDate:"",fromDateAPI:"",endDate:"",endDateAPI:"",pagination:{sortBy:"dpdDate",descending:!0,page:1,rowsPerPage:100,rowsNumber:2e4},columns:[{name:"index",required:!0,label:"NO",align:"left",field:"index"},{name:"dpdDate",required:!0,label:"DATE",align:"left",field:"dpdDate"},{name:"dpdRoute",required:!0,label:"ROUTE",align:"left",field:"dpdRoute"},{name:"driver_name",required:!0,label:"DRIVER",align:"left",field:"driver_name"},{name:"dpdPayType",required:!0,label:"PAY TYPE",align:"left",field:"dpdPayType"},{name:"dpdStops",required:!0,label:"STOPS",align:"left",field:"dpdStops"},{name:"dpdPayment",required:!0,label:"PAYMENT",align:"left",field:"dpdPayment"}],dpdPerformanceList:[],dpdPerformanceAll:[],is_mobile:"web",isDateFilter:!1,selectedPeriod:{},periods:[],selectedDriver:null,driverNames:[],selectedDpdRoute:null,dpdRouteNumbers:[]}},computed:{userLevel:{get:function(){return this.$store.state.auth.userLevel}}},mounted:function(){var e=this;return d()(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.checkPlatform(),e.$store.commit("auth/pageTitle",e.$router.currentRoute.meta.title),t.next=4,e.getDriverAll();case 4:return t.next=6,e.getDpdRouteAll();case 6:return t.next=8,e.getPeriods();case 8:e.getDpdPerformanceList({pagination:e.pagination,filter:void 0});case 9:case"end":return t.stop()}}),t)})))()},methods:{checkPlatform:function(){this.$q.platform.is.mobile?this.$q.platform.is.ios?this.is_mobile="ios":this.is_mobile="android":this.is_mobile="web"},getDriverAll:function(){var e=d()(o.a.mark((function e(){var t;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l["a"].getDriverList();case 3:t=e.sent,this.driverNames=t.data.data,e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](0);case 9:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}(),getDpdRouteAll:function(){var e=d()(o.a.mark((function e(){var t;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l["a"].getDpdRouteAll();case 3:t=e.sent,this.dpdRouteNumbers=t.data.data,e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](0);case 9:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}(),getPeriods:function(){var e=this;return d()(o.a.mark((function t(){var r,n;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return c["a"].show(),t.prev=1,r=u["b"].formatDate(new Date,"YYYY-MM-DD"),t.next=5,l["a"].getPeriods(r);case 5:n=t.sent,c["a"].hide(),e.periods=n.data.data,e.periods.length&&(e.selectedPeriod=e.periods.filter((function(e){if(e.firstTransactionDate<=r&&e.lastTransactionDate>=r)return e}))[0]),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](1),console.log("get periods error",t.t0),c["a"].hide();case 15:case"end":return t.stop()}}),t,null,[[1,11]])})))()},changeDateFormat:function(e){var t=u["b"].formatDate(u["b"].addToDate(u["b"].extractDate(e,"YYYY-MM-DD"),{hours:5}),"DD-MM-YY dddd");return t},onChangePeriod:function(){var e=this;return d()(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isDateFilter=!0,t.next=3,e.getDpdPerformanceList({pagination:e.pagination,filter:e.filter,isScroll:!1});case 3:case"end":return t.stop()}}),t)})))()},goToDetail:function(e){var t=this;return d()(o.a.mark((function r(){return o.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:e&&t.$router.push({name:"Edit DPD Modules",params:{dpdDate:e.dpdDate}});case 1:case"end":return r.stop()}}),r)})))()},onScroll:function(e){var t=this;return d()(o.a.mark((function r(){var n,a,i,s,d,l,c;return o.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=e.index,e.from,e.to,e.ref,a=t.pagination,i=a.page,s=a.rowsPerPage,d=a.rowsNumber,l=t.dpdPerformanceList.length-1,c=Math.ceil(d/s),!(n>0&&i<c&&n===l)){r.next=8;break}return t.pagination.page++,r.next=8,t.getDpdPerformanceList({pagination:t.pagination,filter:t.filter,isScroll:!0});case 8:case"end":return r.stop()}}),r)})))()},onChangeDriver:function(){this.getDpdPerformanceList({pagination:this.pagination,isScroll:!1})},onChangeRoute:function(){this.getDpdPerformanceList({pagination:this.pagination,isScroll:!1})},getDpdPerformanceList:function(){var e=d()(o.a.mark((function e(t){var r,n,a,i,s,d,u,p,f,m,h;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.pagination,n=r.page,a=r.rowsPerPage,i=r.rowsNumber,s=r.sortBy,d=r.descending,t.filter,u=t.isScroll,p=0===a?i:a,f=(n-1)*a,m={conditions:{is_date_filter:!0},start:f,numPerPage:p,sortBy:s,descending:d,fromDate:"",endDate:""},this.selectedDriver&&(m.conditions.driver_name=this.selectedDriver.driver_name),this.selectedDpdRoute&&(m.conditions.dpdRoute=this.selectedDpdRoute.dpdRoute),this.isDateFilter?(m.fromDate=this.selectedPeriod.firstTransactionDate,m.endDate=this.selectedPeriod.lastTransactionDate):m.conditions.is_date_filter=!1,c["a"].show(),e.prev=10,e.next=13,l["a"].getDpdPerformanceList(m);case 13:h=e.sent,c["a"].hide(),h.data.data.forEach((function(e,t){e.index=100*(n-1)+t+1})),this.dpdPerformanceList=u?this.dpdPerformanceList.concat(h.data.data):h.data.data,this.pagination.rowsNumber=h.data.totalCount,this.pagination.page=n,this.pagination.rowsPerPage=a,this.pagination.sortBy=s,this.pagination.descending=d,e.next=28;break;case 24:e.prev=24,e.t0=e["catch"](10),c["a"].hide(),console.log("errorrrrrrrrrr",e.t0);case 28:case"end":return e.stop()}}),e,this,[[10,24]])})));function t(t){return e.apply(this,arguments)}return t}(),getDpdPerformanceAll:function(){var e=d()(o.a.mark((function e(t){var r,n;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.filter,r={conditions:{is_date_filter:!0},fromDate:"",endDate:""},this.selectedDriver&&(r.conditions.driver_name=this.selectedDriver.driver_name),this.selectedDpdRoute&&(r.conditions.dpdRoute=this.selectedDpdRoute.dpdRoute),this.isDateFilter?(r.fromDate=this.selectedPeriod.firstTransactionDate,r.endDate=this.selectedPeriod.lastTransactionDate):r.conditions.is_date_filter=!1,c["a"].show(),e.prev=6,e.next=9,l["a"].getDpdPerformanceAll(r);case 9:n=e.sent,c["a"].hide(),n.data.data.forEach((function(e,t){e.index=t+1})),this.dpdPerformanceAll=n.data.data,e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](6),c["a"].hide(),console.log("errorrrrrrrrrr",e.t0);case 19:case"end":return e.stop()}}),e,this,[[6,15]])})));function t(t){return e.apply(this,arguments)}return t}(),exportTable:function(){var e=this;return d()(o.a.mark((function t(){var r,n,a;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDpdPerformanceAll({filter:e.filter});case 2:r=e.columns,n=[r.map((function(e){return f(e.label)}))].concat(e.dpdPerformanceAll.map((function(e){return r.map((function(t){return"dpdPayType"===t.field?f("fixed"===e.is_group?"FIXED":"PAY PER STOP",t.format):f(e[t.field],t.format)})).join(",")}))).join("\r\n"),a=Object(p["a"])("table-export.csv",n,"text/csv"),!0!==a&&e.$q.notify({message:"Browser denied file download...",color:"negative",icon:"warning"});case 6:case"end":return t.stop()}}),t)})))()},totalStops:function(){return this.dpdPerformanceList.reduce((function(e,t){return"per_stop"==t["dpdPayType"]?e+Number(t["dpdStops"]):e+0}),0)},totalPayment:function(){return this.dpdPerformanceList.reduce((function(e,t){return e+Number(t["dpdPayment"])}),0).toFixed(2)}},created:function(){}},h=m,v=r("2877"),g=r("9989"),D=r("eaac"),P=r("27f9"),w=r("0016"),b=r("ddd8"),y=r("bd08"),x=r("db86"),_=r("9c40"),k=r("eebe"),R=r.n(k),q=Object(v["a"])(h,n,a,!1,null,null,null);t["default"]=q.exports;R()(q,"components",{QPage:g["a"],QTable:D["a"],QInput:P["a"],QIcon:w["a"],QSelect:b["a"],QTr:y["a"],QTd:x["a"],QBtn:_["a"]})}}]);